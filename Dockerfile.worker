FROM prefecthq/prefect:3-python3.11

COPY pyproject.toml ./
COPY README.md ./

RUN pip install --upgrade pip
RUN pip install .[ml]

WORKDIR /app
ENV PREFECT_WORK_DIR=/app

COPY ./prefect ./
COPY ./prefect/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
